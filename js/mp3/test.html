<!DOCTYPE html>
<html>

<head>
    <title>test2</title>
    <script type="text/javascript" src="../sea.js"></script>
</head>

<body>
    <script type="text/javascript">
    seajs.use(['mp3/id3tag','mp3/header','mp3/sideinfo','mp3/scalefactor','mp3/huffman'],
        function(Id3Tag, Header, Sideinfo, ScaleFactor, Huffman){
            var audioContext = new(AudioContext || WebkitAudioContext)();

            function load(begin, end, cb) {
                var request = new XMLHttpRequest();
                request.open('GET', 'http://localhost:8000/test/src/test.mp3', true);
                request.responseType = 'arraybuffer';
                request.onload = function() {
                    cb(request)
                }
                request.setRequestHeader("Range", 'bytes=' + begin + '-' + end);
                request.send();
            }
            load(0,'',function(request){
                var buffer = request.response;
                var headerLength = 0;
                var id3Tag = new Id3Tag(buffer);
                headerLength = id3Tag.parseId3V2();
                headerLength += id3Tag.parseApe();
                load(headerLength,'',function(request){
                    var buffer = request.response.slice(1000);
                    var header = new Header(buffer);
                    var sideinfo = new Sideinfo(header.parseHeader(), header);
                    var scaleFactor = new ScaleFactor(sideinfo.parseSideInfo(), sideinfo);
                    var huffman = new Huffman(scaleFactor.parseScaleFactors(0,0), header, sideinfo);
                    huffman.huffmanDecode(0,0);
                })
            });
    })
    // var request = new XMLHttpRequest();
    // request.open('GET', 'http://localhost:8000/js/mp3/huffmantable.js', true);
    // request.onload = function() {
    //     var txt = request.responseText;
    //     var lines = txt.split(/\r\n/);
    //     var str = '';
    //     var c = 0;
    //     for(var i=0; i<lines.length; i++){
    //         var m = lines[i].match(/(\d+?)[\s]+?(\d+?)[\s]+?\d+?[\s]+?(\d+)[\s]*?/);
    //         if(m){
    //             str+= "'"+m[3]+"':["+m[1]+','+m[2]+'],'+'<br>'
    //         }else{
    //             str+=lines[i]+'<br>'
    //         }
    //     }
    //     document.write(str);
    // }
    // var request = new XMLHttpRequest();
    // request.open('GET', 'http://localhost:8000/js/mp3/test.js', true);
    // request.onload = function() {
    //     var txt = request.responseText;
    //     var lines = txt.split(/\r\n/);
    //     var str = '';
    //     var c = 0;
    //     for(var i=0; i<lines.length; i++){
    //         var m = lines[i].match(/(\d+?)[\s]+?\d+?[\s]+?(\d+)[\s]*?/);
    //         if(m){
    //             str+= "'"+m[2]+"':["+m[1].charAt(0)+','+m[1].charAt(1)+','+m[1].charAt(2)+','+m[1].charAt(3)+'],'+'<br>'
    //         }else{
    //             str+=lines[i]+'<br>'
    //         }
    //     }
    //     document.write(str);
    // }
    // request.send();
    </script>
</body>

</html>
